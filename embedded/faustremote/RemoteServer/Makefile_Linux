#####################
# LINUX COMPILATION
#####################

CC            = gcc -g
CXX           = g++ -g
DEFINE	      = D_REENTRANT	
LINK          = g++
LLVM_CONFIG   = llvm-config

INCPATH       = -I. -I/usr/include -I. -I/opt/local/include -I. -F/Library/Frameworks -I/usr/include/dbus-1.0 -I../dns_avahi -I../dns_avahi/avahi-client -I../dns_avahi/avahi-common -I.. -I/usr/lib/x86_64-linux-gnu/dbus-1.0/include   -DDBUS_VERSION_MAJOR=1 -DDBUS_VERSION_MINOR=4 -DDBUS_VERSION_MICRO=18 -DDBUS_API_SUBJECT_TO_CHANGE

LIBS          = -L/usr/local/lib/faust -lfaust -lHTTPDFaust -ljacknet -ljack -L/opt/local/lib -lmicrohttpd -lpthread -lcrypto `$(LLVM_CONFIG) --ldflags` `$(LLVM_CONFIG) --libs` -ldl -ldbus-1 -lpthread -lrt -ldaemon

DESTDIR       = 
TARGET        = ./RemoteServer
####### Files

SOURCES       = Server.cpp main.cpp ../utilities.cpp linux_server/client-publish-service.c linux_server/avahi-client/client.c ../dns_avahi/avahi-common/alternative.c ../dns_avahi/avahi-common/simple-watch.c ../dns_avahi/avahi-common/malloc.c ../dns_avahi/avahi-common/error.c ../dns_avahi/avahi-common/timeval.c ../dns_avahi/avahi-common/cdecl.c ../dns_avahi/avahi-common/address.c ../dns_avahi/avahi-common/strlst.c ../dns_avahi/avahi-common/defs.c ../dns_avahi/avahi-common/watch.c ../dns_avahi/avahi-common/gccmacro.c ../dns_avahi/avahi-common/domain.c ../dns_avahi/avahi-common/utf8.c ../dns_avahi/avahi-common/i18n.c ../dns_avahi/avahi-common/dbus.c ../dns_avahi/avahi-common/dbus-watch-glue.c ../dns_avahi/avahi-client/browser.c ../dns_avahi/avahi-client/xdg-open.c ../dns_avahi/avahi-client/resolver.c ../dns_avahi/avahi-client/entrygroup.c
				 
OBJECTS       = Server.o main.o utilities.o client-publish-service.o client.o alternative.o simple-watch.o malloc.o error.o timeval.o address.o strlst.o domain.o utf8.o i18n.o dbus.o dbus-watch-glue.o browser.o xdg-config.o resolver.o entrygroup.o

first: all

####### Build rules

all: Makefile $(TARGET)

$(TARGET):  $(OBJECTS)
			$(LINK) $(LFLAGS) -o $(TARGET) $(OBJECTS) $(OBJCOMP) $(LIBS)

clean: 
	rm -f $(OBJECTS)
	rm -f $(TARGET)

####### Compile

Server.o: Server.cpp Server.h ../TMutex.h linux_server/client-publish-service.h
	$(CXX) -c $(CXXFLAGS) $(INCPATH) -o Server.o Server.cpp

main.o: main.cpp Server.h
	$(CXX) -c $(CXXFLAGS) $(INCPATH) -o main.o main.cpp

utilities.o: ../utilities.h
	$(CXX) -c $(CXXFLAGS) $(INCPATH) -o utilities.o ../utilities.cpp

####### Compile

client-publish-service.o: linux_server/client-publish-service.c linux_server/client-publish-service.h ../dns_avahi/avahi-client/client.h ../dns_avahi/avahi-client/publish.h ../dns_avahi/avahi-common/alternative.h ../dns_avahi/avahi-common/simple-watch.h ../dns_avahi/avahi-common/malloc.h ../dns_avahi/avahi-common/error.h ../dns_avahi/avahi-common/timeval.h
	$(CC) -c $(CXXFLAGS) $(INCPATH) -o client-publish-service.o linux_server/client-publish-service.c

client.o: ../dns_avahi/avahi-client/client.c ../dns_avahi/avahi-client/client.h ../dns_avahi/avahi-common/cdecl.h ../dns_avahi/avahi-common/address.h ../dns_avahi/avahi-common/strlst.h ../dns_avahi/avahi-common/defs.h ../dns_avahi/avahi-common/watch.h ../dns_avahi/avahi-common/gccmacro.h ../dns_avahi/avahi-common/dbus.h ../dns_avahi/avahi-common/llist.h ../dns_avahi/avahi-common/error.h ../dns_avahi/avahi-common/malloc.h ../dns_avahi/avahi-common/dbus-watch-glue.h ../dns_avahi/avahi-common/i18n.h ../dns_avahi/avahi-client/internal.h ../dns_avahi/avahi-client/browser.c
	$(CC) -c $(CXXFLAGS) $(INCPATH) -o client.o ../dns_avahi/avahi-client/client.c

alternative.o: ../dns_avahi/avahi-common/alternative.h ../dns_avahi/avahi-common/alternative.c ../dns_avahi/avahi-common/cdecl.h ../dns_avahi/avahi-common/malloc.h ../dns_avahi/avahi-common/domain.h ../dns_avahi/avahi-common/utf8.h
	$(CC) -c $(CXXFLAGS) $(INCPATH) -o alternative.o ../dns_avahi/avahi-common/alternative.c

simple-watch.o: ../dns_avahi/avahi-common/simple-watch.h ../dns_avahi/avahi-common/simple-watch.c ../dns_avahi/avahi-common/cdecl.h ../dns_avahi/avahi-common/watch.h
	$(CC) -c $(CXXFLAGS) $(INCPATH) -o simple-watch.o ../dns_avahi/avahi-common/simple-watch.c

malloc.o: ../dns_avahi/avahi-common/malloc.h ../dns_avahi/avahi-common/cdecl.h ../dns_avahi/avahi-common/gccmacro.h
	$(CC) -c $(CXXFLAGS) $(INCPATH) -o malloc.o ../dns_avahi/avahi-common/malloc.c

error.o: ../dns_avahi/avahi-common/error.h ../dns_avahi/avahi-common/error.c ../dns_avahi/avahi-common/cdecl.h ../dns_avahi/avahi-common/i18n.h
	$(CC) -c $(CXXFLAGS) $(INCPATH) -o error.o ../dns_avahi/avahi-common/error.c

timeval.o: ../dns_avahi/avahi-common/timeval.h ../dns_avahi/avahi-common/timeval.c ../dns_avahi/avahi-common/cdecl.h
	$(CC) -c $(CXXFLAGS) $(INCPATH) -o timeval.o ../dns_avahi/avahi-common/timeval.c

address.o: ../dns_avahi/avahi-common/address.h ../dns_avahi/avahi-common/address.c ../dns_avahi/avahi-common/cdecl.h
	$(CC) -c $(CXXFLAGS) $(INCPATH) -o address.o ../dns_avahi/avahi-common/address.c

strlst.o: ../dns_avahi/avahi-common/strlst.h ../dns_avahi/avahi-common/strlst.c ../dns_avahi/avahi-common/cdecl.h ../dns_avahi/avahi-common/gccmacro.h
	$(CC) -c $(CXXFLAGS) $(INCPATH) -o strlst.o ../dns_avahi/avahi-common/strlst.c

domain.o: ../dns_avahi/avahi-common/domain.h ../dns_avahi/avahi-common/domain.c ../dns_avahi/avahi-common/malloc.h ../dns_avahi/avahi-common/error.h ../dns_avahi/avahi-common/address.h ../dns_avahi/avahi-common/utf8.h
	$(CC) -c $(CXXFLAGS) $(INCPATH) -o domain.o ../dns_avahi/avahi-common/domain.c

utf8.o: ../dns_avahi/avahi-common/utf8.h ../dns_avahi/avahi-common/utf8.c ../dns_avahi/avahi-common/cdecl.h
	$(CC) -c $(CXXFLAGS) $(INCPATH) -o utf8.o ../dns_avahi/avahi-common/utf8.c

i18n.o: ../dns_avahi/avahi-common/i18n.h ../dns_avahi/avahi-common/i18n.c
	$(CC) -c $(CXXFLAGS) $(INCPATH) -o i18n.o ../dns_avahi/avahi-common/i18n.c 

dbus.o: ../dns_avahi/avahi-common/dbus.c ../dns_avahi/avahi-common/dbus.c ../dns_avahi/avahi-common/cdecl.h ../dns_avahi/avahi-common/error.h
	$(CC) -c $(CXXFLAGS) $(INCPATH) -o dbus.o ../dns_avahi/avahi-common/dbus.c

dbus-watch-glue.o: ../dns_avahi/avahi-common/dbus-watch-glue.c ../dns_avahi/avahi-common/dbus-watch-glue.c ../dns_avahi/avahi-common/malloc.h ../dns_avahi/avahi-common/timeval.h
	$(CC) -c $(CXXFLAGS) $(INCPATH) -o dbus-watch-glue.o ../dns_avahi/avahi-common/dbus-watch-glue.c 

browser.o: ../dns_avahi/avahi-client/browser.c ../dns_avahi/avahi-common/dbus.h ../dns_avahi/avahi-common/llist.h ../dns_avahi/avahi-common/error.h ../dns_avahi/avahi-common/malloc.h ../dns_avahi/avahi-common/domain.h ../dns_avahi/avahi-client/client.h ../dns_avahi/avahi-client/internal.h ../dns_avahi/avahi-client/xdg-config.h
	$(CC) -c $(CXXFLAGS) $(INCPATH) -o browser.o ../dns_avahi/avahi-client/browser.c 

xdg-config.o: ../dns_avahi/avahi-client/xdg-config.c ../dns_avahi/avahi-client/xdg-config.h
	$(CC) -c $(CXXFLAGS) $(INCPATH) -o xdg-config.o ../dns_avahi/avahi-client/xdg-config.c

resolver.o: ../dns_avahi/avahi-client/resolver.c ../dns_avahi/avahi-client/lookup.h
	$(CC) -c $(CXXFLAGS) $(INCPATH) -o resolver.o ../dns_avahi/avahi-client/resolver.c

entrygroup.o: ../dns_avahi/avahi-client/entrygroup.c ../dns_avahi/avahi-client/lookup.h
	$(CC) -c $(CXXFLAGS) $(INCPATH) -o entrygroup.o ../dns_avahi/avahi-client/entrygroup.c

