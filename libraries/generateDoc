#!/bin/bash

for p in $@; do
	if [ $p = "-help" ] || [ $p = "-h" ]; then
		echo "Just run it! It will automatically look for all the .lib files and generate the corresponding documentation in /doc."
		exit 1
	fi
done

FILES="analyzer.lib basic.lib delay.lib misceffect.lib compressor.lib vaeffect.lib phafla.lib reverb.lib envelope.lib filter.lib miscoscillator.lib noise.lib hoa.lib math.lib pm.lib signal.lib route.lib spat.lib synth.lib demo.lib"

for p in $FILES; do
	faust2md $p > doc/${p%.lib}.md
done

# Generate the raw html version of the doc
pandoc --toc --standalone doc/*.md -o doc/index.html

# Generate the PDF doc
pandoc --toc doc/*.md -o doc/libraries-reference.pdf

sed -i "" "s/<title>/<title>Faust Libraries Documentation/g" doc/index.html 
sed -i "" "s/<style type=\"text\/css\">code{white-space: pre;}<\/style>/<\/style><link rel=\"stylesheet\" href=\"http:\/\/maxcdn.bootstrapcdn.com\/bootstrap\/3.3.7\/css\/bootstrap.min.css\"><script src=\"https:\/\/ajax.googleapis.com\/ajax\/libs\/jquery\/1.12.4\/jquery.min.js\">\n<\/script><script src=\"http:\/\/maxcdn.bootstrapcdn.com\/bootstrap\/3.3.7\/js\/bootstrap.min.js\"><\/script>/g" doc/index.html 
sed -i "" "s/<body>/<div class=\"container\"><div class=\"row\" style=\"height: 100vh;\">/g" doc/index.html 
sed -i "" "s/<\/body>/<\/div><\/div><\/body>/g" doc/index.html 
sed -i "" "s/<div id=\"TOC\">/<div class=\"col-sm-4\" id=\"TOC\" style=\"height: 100%;overflow: scroll;\">/g" doc/index.html 
sed -i "" "s/<h1 id=\"analyzer.lib\">analyzer.lib<\/h1>/<div class=\"col-sm-8\" style=\"height: 100%;overflow-y: scroll\"><h1 id=\"analyzer.lib\">analyzer.lib<\/h1>/g" doc/index.html 
 
